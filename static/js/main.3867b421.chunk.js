(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{133:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(9),r=a.n(s),o=a(13),l=a(10),c=a(15),u=a(14),d=a(16),m=function(e){var t=e.children;return i.a.createElement("div",{style:{margin:"3rem auto",maxWidth:650,padding:"0 1rem"}},t)},h=a(68);a(106),a(71),a(134);h.initializeApp({apiKey:"AIzaSyCmdA27Yq_H79ugY2uCSzNNZV_JuzBxh0Q",authDomain:"let-it-go-e6229.firebaseapp.com",databaseURL:"https://let-it-go-e6229.firebaseio.com",projectId:"let-it-go-e6229",storageBucket:"let-it-go-e6229.appspot.com",messagingSenderId:"917575844853",appId:"1:917575844853:web:88ec0cbe059a0d43"});var p=h,b={color:"gray",fontFamily:"Georgia, serif",fontSize:"1.5em",fontStyle:"italic",lineHeight:"1.4",margin:"0",textShadow:"0 1px white",zIndex:"600",textAlign:"center"},g=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={},a.unmounted=!1,a.db=p.firestore(),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.db.collection("toiletQuotes").doc("quotes").get().then(function(t){var a=t.data().quotes,n=a[Math.floor(Math.random()*a.length)];e.unmounted||e.setState({quote:"\u201c"+n+"\u201d"})}).catch(function(){return e.setState({quote:"\u201cFeces are meant to be released in peace.\u201d"})})}},{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"render",value:function(){return i.a.createElement("p",{style:b},this.state.quote)}}]),t}(i.a.Component),v=a(39),f=a(18),E=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.viewer=window.pannellum.viewer("panorama",{type:"equirectangular",panorama:this.props.url,vaov:45,maxPitch:0,minPitch:0,autoLoad:!0})}},{key:"componentWillUnmount",value:function(){this.viewer.destroy()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{id:"panorama",style:{width:"100%",height:200}}))}}]),t}(i.a.Component),w=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).submission=a.props.submission,a.staticMapUrl="https://maps.googleapis.com/maps/api/staticmap?size=650x300&markers=|".concat(a.submission.lat,", ").concat(a.submission.lon,"&key=").concat("AIzaSyCmdA27Yq_H79ugY2uCSzNNZV_JuzBxh0Q"),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handicappedText",value:function(){return this.submission.facilities.handicapped?this.submission.facilities.separateHandicapped?"Is handicapped accessible (Has separate handicapped toilet)":"Is handicapped accessible (Handicapped cubicle inside toilet)":"Is handicapped accessible"}},{key:"glanceStyle",value:function(e){return{textDecoration:e?"":"line-through",color:e?"":"gray"}}},{key:"render",value:function(){return i.a.createElement(m,null,i.a.createElement("h3",null,this.submission.name),i.a.createElement("img",{src:this.staticMapUrl,alt:"Static map preview"}),i.a.createElement(E,{url:this.submission.panorama.url}),i.a.createElement("h4",null,"At a glance"),i.a.createElement("ul",{style:{listStyle:"none"}},i.a.createElement("li",{style:this.glanceStyle(this.submission.facilities.male)},i.a.createElement("i",{className:"em-svg em-man-raising-hand"}),"Has Male toilet"),i.a.createElement("li",{style:this.glanceStyle(this.submission.facilities.female)},i.a.createElement("i",{className:"em-svg em-woman-raising-hand"}),"Has Female toilet"),i.a.createElement("li",{style:this.glanceStyle(this.submission.facilities.handicapped)},i.a.createElement("i",{className:"em-svg em-wheelchair"}),this.handicappedText()),i.a.createElement("li",{style:this.glanceStyle(this.submission.facilities.waterCooler)},i.a.createElement("i",{className:"em-svg em-potable_water"}),"Has water cooler"),i.a.createElement("li",{style:this.glanceStyle(this.submission.facilities.showerHeads)},i.a.createElement("i",{className:"em-svg em-shower"}),"Has shower heads"),i.a.createElement("li",{style:this.glanceStyle(this.submission.facilities.hose)},i.a.createElement("i",{className:"em-svg em-sweat_drops"}),"Has hose")))}}]),t}(i.a.Component),y=a(169),k=a(172),S=a(167),C=a(187),j=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(S.a,null,i.a.createElement(y.a,null,"Sort by"),i.a.createElement(C.a,{value:this.props.value,autoWidth:!0,onChange:this.props.handleSorting},i.a.createElement(k.a,{value:"name"},"Name"),i.a.createElement(k.a,{value:"date"},"Date (Newest first)"),i.a.createElement(k.a,{value:"status"},"Status")))}}]),t}(i.a.Component),O=a(182),H=a(184),I=a(174),L=a(183),A=a(173),D=a(171),R=a(176),x=a(136),U=a(175),M=a(59),P=a(189),T=a(177),N=a(191),F=a(178),W=a(179),z=a(180),_=a(181),B=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).submissionsDb=p.firestore().collection("userSubmissions"),a.toiletDb=p.firestore().collection("toilets"),a.reviewsDb=p.firestore().collection("reviews"),a.storage=p.storage(),a.handleSorting=a.handleSorting.bind(Object(f.a)(a)),a.state={submissions:[],submissionToReject:{},submissionToApprove:{},remarks:"",previewRow:null,sortBy:"date",showAcceptedReviews:!1},a.getAllSubmissions(),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"getAllSubmissions",value:function(){var e=this,t=[],a=new Map;this.submissionsDb.get().then(function(n){n.forEach(function(n){var i=n.data().currentUser.uid;console.log(n.data().currentUser),e.submissionsDb.doc(i).collection("submissions").onSnapshot(function(s){s.forEach(function(e){var s={userUid:i,currentUser:n.data().currentUser,userPhoto:n.data().currentUser.photoURL,docId:e.id,date:e.data().date,isFemale:e.data().facilities.female,isMale:e.data().facilities.male,isHandicapped:e.data().facilities.handicapped,isSeparateHandicapped:e.data().facilities.separateHandicapped,hasHose:e.data().facilities.hose,hasShowerHeads:e.data().facilities.showerHeads,hasWaterCooler:e.data().facilities.waterCooler,lat:e.data().lat,lon:e.data().lon,name:e.data().name,paranomaUrl:e.data().panorama.url,panoramaFileName:e.data().panorama.fileName,status:e.data().status.approval,remarks:e.data().status.remarks};a.has(s.docId)||(a.set(s.docId,!0),t.push(s))}),s.docChanges().forEach(function(e){var a=e.doc.id,n=t.find(function(e){return e.docId===a}),s=n.rowId;t[s]={userUid:i,docId:n.id,date:e.doc.data().date,isFemale:e.doc.data().facilities.female,isMale:e.doc.data().facilities.male,isHandicapped:e.doc.data().facilities.handicapped,isSeparateHandicapped:e.doc.data().facilities.separateHandicapped,hasHose:e.doc.data().facilities.hose,hasShowerHeads:e.doc.data().facilities.showerHeads,hasWaterCooler:e.doc.data().facilities.waterCooler,lat:e.doc.data().lat,lon:e.doc.data().lon,name:e.doc.data().name,paranomaUrl:e.doc.data().panorama.url,status:e.doc.data().status.approval,remarks:e.doc.data().status.remarks}});var r=-1;t.map(function(e){return r++,e.rowId=r,e}),t.sort(G),e.setState({submissions:t})})})})}},{key:"generateFacilities",value:function(e){return i.a.createElement("div",{style:{textAlign:"center"}},e.isMale&&i.a.createElement("i",{className:"em-svg em-man-raising-hand"}),e.isFemale&&i.a.createElement("i",{className:"em-svg em-woman-raising-hand"}),e.hasWaterCooler&&i.a.createElement("i",{className:"em-svg em-potable_water"})," ",e.hasShowerHeads&&i.a.createElement("i",{className:"em-svg em-shower"})," ",e.hasHose&&i.a.createElement("i",{className:"em-svg em-sweat_drops"})," ",e.isHandicapped&&i.a.createElement("i",{className:"em-svg em-wheelchair"}))}},{key:"submissionAction",value:function(e){var t=this;return i.a.createElement(S.a,null,i.a.createElement(C.a,{value:[10,20,30],onChange:function(a){var n=t.state.submissions[e];switch(a.target.value){case"Approve":t.triggerDialogToConfirmApprove(n,e);break;case"Reject":t.handleRejectSubmissionClicked(n,e)}}},i.a.createElement(k.a,{value:"Approve"},"Approve"),i.a.createElement(k.a,{value:"Reject"},"Reject")))}},{key:"triggerDialogToConfirmApprove",value:function(e,t){this.setState({submissionToApprove:e,submissionIndex:t,approveDialogOpened:!0})}},{key:"approveSubmission",value:function(){var e=this,t=this.state.remarks[this.state.submissionIndex],a=this.state.submissionToApprove;this.submissionsDb.doc(this.state.submissionToApprove.userUid).collection("submissions").doc(this.state.submissionToApprove.docId).update({status:{approval:"approved",remarks:null==t?"":t}}),this.storage.refFromURL(a.paranomaUrl).getDownloadURL().then(function(t){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(t){var i=n.response,s=e.storage.ref().child("approved/".concat(a.panoramaFileName)).put(i);s.on("state_changed",null,function(e){return console.log(e)},function(){s.snapshot.ref.getDownloadURL().then(function(t){e.toiletDb.doc(a.name).set({facilities:{female:a.isFemale,handicapped:a.isHandicapped,hose:a.hasHose,male:a.isMale,separateHandicapped:a.isSeparateHandicapped,showerHeads:a.hasShowerHeads,waterCooler:a.hasWaterCooler},lat:a.lat,lon:a.lon,name:a.name,paranomaUrl:t}).then(function(){e.setState({approveDialogOpened:!1})}),e.reviewsDb.doc(a.name).set({})})})},n.open("GET",t),n.send()})}},{key:"handleRejectSubmissionClicked",value:function(e,t){this.setState({rejectDialogOpened:!0,submissionToReject:e,submissionIndex:t})}},{key:"rejectSubmission",value:function(){var e=this,t=this.state.remarks[this.state.submissionIndex];this.submissionsDb.doc(this.state.submissionToReject.userUid).collection("submissions").doc(this.state.submissionToReject.docId).update({status:{approval:"rejected",remarks:t||this.state.submissionToReject.remarks}}).then(function(){e.setState({rejectDialogOpened:!1})})}},{key:"handleTextChange",value:function(e,t){this.setState({remarks:Object(v.a)({},t,e.target.value)})}},{key:"generateTable",value:function(){var e=this;return this.state.submissions.filter(function(t){return e.state.showAcceptedReviews?t:"pending"===t.status||"rejected"===t.status}).map(function(t,a){return i.a.createElement(i.a.Fragment,{key:a},i.a.createElement(A.a,null,i.a.createElement(I.a,{style:{whiteSpace:"normal",wordWrap:"break-word"}},i.a.createElement(x.a,{style:{justifyContent:"center",textAlign:"center",flexDirection:"column",margin:0,padding:0}},i.a.createElement(U.a,{src:t.userPhoto}),i.a.createElement(M.a,{variant:"body1",noWrap:!0,style:{fontSize:15,maxWidth:120}},i.a.createElement("b",null,t.currentUser.name)))),i.a.createElement(I.a,null,t.name+" ",t.rowId!==e.state.previewRow?i.a.createElement(R.a,{onClick:function(){return e.setState({previewRow:t.rowId})},color:"primary"},"Preview"):i.a.createElement(R.a,{onClick:function(){return e.setState({previewRow:null})},color:"secondary"},"Hide")),i.a.createElement(I.a,null,t.date.toDate().toLocaleString("default",{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric"})),i.a.createElement(I.a,null,e.generateFacilities(t)),i.a.createElement(I.a,{size:"small"},i.a.createElement(P.a,{multiline:!0,defaultValue:t.remarks,fullWidth:!0,margin:"dense",inputProps:{style:{fontSize:15}},onChange:function(a){e.handleTextChange(a,t.rowId)}})),i.a.createElement(I.a,null,null==t.status?"Pending":t.status," "),i.a.createElement(I.a,null,e.submissionAction(t.rowId))),e.state.previewRow===t.rowId&&i.a.createElement(A.a,null,i.a.createElement(I.a,{colSpan:7},i.a.createElement(w,{submission:Object.assign({panorama:{url:t.paranomaUrl},facilities:{hose:t.hasHose,showerHeads:t.hasShowerHeads,waterCooler:t.hasWaterCooler,male:t.isMale,separateHandicapped:t.isSeparateHandicapped,handicapped:t.isHandicapped,female:t.isFemale}},t)}))))})}},{key:"handleSorting",value:function(e){var t=this.state.submissions.slice();switch(e.target.value){case"name":t.sort(q);break;case"date":t.sort(G);break;case"status":t.sort(J)}this.setState({submissions:t,sortBy:e.target.value})}},{key:"render",value:function(){var e=this;return i.a.createElement(T.a,{style:{padding:0,textAlign:"center"}},i.a.createElement(R.a,{variant:"contained",color:"primary",onClick:function(){return e.setState({showAcceptedReviews:!e.state.showAcceptedReviews})}},(this.state.showAcceptedReviews?"Hide ":"Show ")+"Accepted Reviews"),i.a.createElement(D.a,{style:{margin:20}},i.a.createElement(N.a,{onClose:function(){e.setState({approveDialogOpened:!1})},open:this.state.approveDialogOpened},i.a.createElement(F.a,null,"Are you sure?"),i.a.createElement(W.a,null,i.a.createElement(z.a,null,"Do you really want to approve "+this.state.submissionToApprove.name+" with the remarks "+(this.state.remarks[this.state.submissionIndex]?this.state.remarks[this.state.submissionIndex]:this.state.submissionToApprove.remarks)+"?")),i.a.createElement(_.a,null,i.a.createElement(R.a,{onClick:function(){return e.approveSubmission()}},"Approve"),i.a.createElement(R.a,{onClick:function(){e.setState({approveDialogOpened:!1})}},"Cancel"))),i.a.createElement(N.a,{onClose:function(){e.setState({rejectDialogOpened:!1})},open:this.state.rejectDialogOpened},i.a.createElement(F.a,null,"Are you sure?"),i.a.createElement(W.a,null,i.a.createElement(z.a,null,"Do you really want to reject "+this.state.submissionToReject.name+" with the remarks "+(this.state.remarks[this.state.submissionIndex]?this.state.remarks[this.state.submissionIndex]:this.state.submissionToReject.remarks)+"?")),i.a.createElement(_.a,null,i.a.createElement(R.a,{onClick:function(){return e.rejectSubmission()}},"Reject"),i.a.createElement(R.a,{onClick:function(){e.setState({rejectDialogOpened:!1})}},"Cancel"))),i.a.createElement(j,{value:this.state.sortBy,handleSorting:this.handleSorting}),i.a.createElement(O.a,{style:{minWidth:650}},i.a.createElement(L.a,null,i.a.createElement(A.a,null,i.a.createElement(I.a,null,"User"),i.a.createElement(I.a,null,"Name"),i.a.createElement(I.a,null,"Submission Date"),i.a.createElement(I.a,null,"Facilities"),i.a.createElement(I.a,null,"Remarks "),i.a.createElement(I.a,null,"Status"),i.a.createElement(I.a,null,"Action"))),i.a.createElement(H.a,null,this.generateTable()))))}}]),t}(i.a.Component);function q(e,t){return e.name.localeCompare(t.name)}function G(e,t){return t.date.toDate()-e.date.toDate()}function J(e,t){var a,n;switch(e.status){case"rejected":a=-1;break;case"approved":a=0;break;default:a=1}switch(t.status){case"rejected":n=-1;break;case"approved":n=0;break;default:n=1}return a-n}var Y=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"watchLocation",value:function(){var e=this;navigator.geolocation?(this.props.setLocationAvailable(),this.id=navigator.geolocation.watchPosition(function(t){var a=t.coords.latitude,n=t.coords.longitude;e.props.updateMyLocation(a,n),e.myLocation.setPosition({lat:a,lng:n}),e.accuracyRadius.setCenter({lat:a,lng:n}),e.accuracyRadius.setRadius(t.coords.accuracy)},function(){return e.props.setLocationNotAvailable()},{enableHighAccuracy:!0})):this.props.setLocationNotAvailable()}},{key:"componentDidMount",value:function(){var e=this,t={lat:1.296675,lng:103.776396};this.map=new window.google.maps.Map(document.getElementById("map"),{zoom:13,center:t}),this.myLocation=new window.google.maps.Marker({position:t,map:this.map,icon:"https://raw.githubusercontent.com/nelsontky/let-it-go/master/assets/icons/locationMarker.png"}),this.accuracyRadius=new window.google.maps.Circle({map:this.map,center:t,radius:0,fillColor:"#00F",fillOpacity:.2,strokeWeight:0}),this.map.addListener("click",function(t){e.props.handleMapClick(t.latLng.lat(),t.latLng.lng()),null!=e.marker&&e.marker.setMap(null),e.marker=new window.google.maps.Marker({position:t.latLng,map:e.map})}),this.accuracyRadius.addListener("click",function(t){e.props.handleMapClick(t.latLng.lat(),t.latLng.lng()),null!=e.marker&&e.marker.setMap(null),e.marker=new window.google.maps.Marker({position:t.latLng,map:e.map})}),this.myLocation.addListener("click",function(){e.props.handleMapClick(e.myLocation.getPosition().lat(),e.myLocation.getPosition().lng()),null!=e.marker&&e.marker.setMap(null),e.marker=new window.google.maps.Marker({position:e.myLocation.getPosition(),map:e.map})});var a=this;var n=document.createElement("div");new function(e,t){var n=document.createElement("div");n.style.backgroundColor="#fff",n.style.border="2px solid #fff",n.style.borderRadius="3px",n.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",n.style.cursor="pointer",n.style.textAlign="center",n.style.marginBottom="22px",n.style.height="31px",n.title="Click to recenter the map to location",e.appendChild(n);var i=document.createElement("div");i.innerHTML="<img src='https://i.imgur.com/raFRca2.png' />",n.appendChild(i),n.addEventListener("click",function(){t.setCenter(a.myLocation.getPosition())})}(n,this.map),n.index=1,this.map.controls[window.google.maps.ControlPosition.LEFT_BOTTOM].push(n),this.watchLocation()}},{key:"componentWillUnmount",value:function(){navigator.geolocation.clearWatch(this.id)}},{key:"render",value:function(){return i.a.createElement("div",{id:"map",style:{width:"100%",height:"300px"}})}}]),t}(i.a.Component),V=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={remarksShown:!1},a.approval=a.props.status.approval,a.remarks=a.props.status.remarks,a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return"rejected"===this.approval?i.a.createElement("div",null,i.a.createElement("p",{style:{color:"red"}},"Rejected ",i.a.createElement(R.a,{color:"primary",onClick:function(){return e.setState({remarksShown:!e.state.remarksShown})}},this.state.remarksShown?"Hide":"Show reason")),this.state.remarksShown&&i.a.createElement("p",null,this.remarks)):"pending"===this.approval?i.a.createElement("p",null,i.a.createElement("em",null,"Submission pending review")):i.a.createElement("p",{style:{color:"green"}},"Approved!")}}]),t}(i.a.Component),Q=a(79),Z=a.n(Q);function K(e,t){return e.submission.name.localeCompare(t.submission.name)}function X(e,t){return t.submission.date.toDate()-e.submission.date.toDate()}function $(e,t){var a,n;switch(e.submission.status.approval){case"rejected":a=-1;break;case"approved":a=0;break;default:a=1}switch(t.submission.status.approval){case"rejected":n=-1;break;case"approved":n=0;break;default:n=1}return a-n}var ee=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).submission=a.props.children.submission,a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("h4",null,this.submission.name),i.a.createElement(V,{status:this.submission.status}),i.a.createElement("div",null,i.a.createElement(R.a,{variant:"contained",color:this.props.children.id===this.props.previewId?"secondary":"default",onClick:this.props.children.id===this.props.previewId?this.props.handleHide:function(){return e.props.handlePreview(e.props.children.id)}},this.props.children.id===this.props.previewId?"Hide":"Preview")," ",i.a.createElement(R.a,{variant:"contained",color:"primary",disabled:"approved"===this.submission.status.approval,onClick:function(){return e.props.handleEdit(e.submission,e.props.children.id)}},"Edit")," ",i.a.createElement(R.a,{variant:"contained",color:"secondary",onClick:function(){return e.props.handleDelete(e.submission.panorama.fileName,e.props.children.id)}},"Delete",i.a.createElement(Z.a,null))),i.a.createElement("br",null),i.a.createElement("div",{style:{color:"gray",fontSize:"80%"}},"Submitted:"," ",this.submission.date.toDate().toLocaleString("default",{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric"})),i.a.createElement("br",null),this.props.children.id===this.props.previewId&&i.a.createElement(w,{submission:this.submission}))}}]),t}(i.a.Component),te=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={submissions:[],previewId:"",loading:!0,sortBy:"status"};var n=[];return a.props.doc.collection("submissions").get().then(function(e){return e.forEach(function(e){n.push({submission:e.data(),id:e.id})})}).then(function(){n.sort($),a.setState({submissions:n,loading:!1})}),a.handlePreview=a.handlePreview.bind(Object(f.a)(a)),a.handleHide=a.handleHide.bind(Object(f.a)(a)),a.handleSorting=a.handleSorting.bind(Object(f.a)(a)),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handlePreview",value:function(e){this.setState({previewId:e})}},{key:"handleHide",value:function(){this.setState({previewId:""})}},{key:"handleSorting",value:function(e){var t=this.state.submissions.slice();switch(e.target.value){case"name":t.sort(K);break;case"date":t.sort(X);break;case"status":t.sort($)}this.setState({submissions:t,sortBy:e.target.value})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,this.state.loading&&i.a.createElement("span",null,"Loading... ..."),!this.state.loading&&0===this.state.submissions.length&&i.a.createElement("span",null,"You have not created any submissions (yet!)"),!this.state.loading&&0!==this.state.submissions.length&&i.a.createElement("div",null,i.a.createElement("br",null),i.a.createElement(j,{key:this.state.sortBy,value:this.state.sortBy,handleSorting:this.handleSorting}),i.a.createElement(O.a,null,i.a.createElement(H.a,null,this.state.submissions.map(function(t,a){return i.a.createElement(A.a,{key:a},i.a.createElement(I.a,null,i.a.createElement(ee,{key:e.state.sortBy,handleEdit:e.props.handleEdit,handleDelete:e.props.handleDelete,handlePreview:e.handlePreview,handleHide:e.handleHide,previewId:e.state.previewId},t)))})))))}}]),t}(i.a.Component),ae=a(80),ne=a.n(ae),ie=a(86),se=function(e){return i.a.createElement(ie.a,{content:e.content,arrow:!0,trigger:"click",placement:"bottom",interactive:!0},i.a.createElement("img",{style:{verticalAlign:"middle"},src:"https://material.io/tools/icons/static/icons/baseline-help_outline-24px.svg",alt:""}))},re=i.a.createElement("div",{style:{textAlign:"left"}},"Check that you have:",i.a.createElement("ul",null,i.a.createElement("li",null,"Enabled your device's GPS settings",i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("a",{style:{textShadow:"none"},href:"https://support.google.com/accounts/answer/3467281",rel:"noopener noreferrer",target:"_blank"},"Android")),i.a.createElement("li",null,i.a.createElement("a",{style:{textShadow:"none"},href:"https://support.apple.com/en-us/HT207092",rel:"noopener noreferrer",target:"_blank"},"iOS")),i.a.createElement("li",null,"Reload this page after enabling GPS settings"))),i.a.createElement("li",null,"Allowed your browser and this website the neccessary permissions to read your location",i.a.createElement("ul",null,i.a.createElement("li",null,"Press allow when a similar prompt as below appears"),i.a.createElement("li",null,"If such a prompt does not appear, reload the page")))),i.a.createElement("img",{src:"https://raw.githubusercontent.com/nelsontky/let-it-go/master/assets/misc/locationHelp.png",alt:""})),oe=function(){return i.a.createElement("p",null,"Location loading/not available",i.a.createElement(se,{content:re}))},le=a(188),ce=a(186),ue=a(135),de=a(185),me=a(125),he=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={name:"",lat:0,lon:0,myLat:0,myLon:0,handicapped:!1,separateHandicapped:!1,hose:!1,showerHeads:!1,male:!1,female:!1,waterCooler:!1,progress:0,progressShown:!1,error:!1,submissionsShown:!1,isLocationAvailable:!1,edit:!1,panorama:{},editPanorama:!1,editDocId:""},a.fileInput=i.a.createRef(),a.db=p.firestore(),a.storage=p.storage(),a.doc=a.db.collection("userSubmissions").doc(a.props.currentUser.uid),a.handleInputChange=a.handleInputChange.bind(Object(f.a)(a)),a.handleMapClick=a.handleMapClick.bind(Object(f.a)(a)),a.updateMyLocation=a.updateMyLocation.bind(Object(f.a)(a)),a.setToCurrentLocation=a.setToCurrentLocation.bind(Object(f.a)(a)),a.setLocationNotAvailable=a.setLocationNotAvailable.bind(Object(f.a)(a)),a.setLocationAvailable=a.setLocationAvailable.bind(Object(f.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(f.a)(a)),a.handleEdit=a.handleEdit.bind(Object(f.a)(a)),a.handleDelete=a.handleDelete.bind(Object(f.a)(a)),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handleInputChange",value:function(e){var t,a="checkbox"===e.target.type?e.target.checked:e.target.value;"handicapped"!==e.target.name?this.setState(Object(v.a)({},e.target.name,a)):this.setState((t={},Object(v.a)(t,e.target.name,a),Object(v.a)(t,"separateHandicapped",a&&this.state.separateHandicapped),t))}},{key:"handleMapClick",value:function(e,t){this.setState({lat:e,lon:t})}},{key:"updateMyLocation",value:function(e,t){this.setState({myLat:e,myLon:t})}},{key:"setLocationNotAvailable",value:function(){this.setState({isLocationAvailable:!1})}},{key:"setLocationAvailable",value:function(){this.setState({isLocationAvailable:!0})}},{key:"setToCurrentLocation",value:function(e){e.preventDefault(),this.setState({lat:this.state.myLat,lon:this.state.myLon})}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),this.state.edit&&!this.state.editPanorama?this.doc.collection("submissions").doc().set({facilities:{female:this.state.female,handicapped:this.state.handicapped,hose:this.state.hose,male:this.state.male,separateHandicapped:this.state.separateHandicapped,showerHeads:this.state.showerHeads,waterCooler:this.state.waterCooler},lat:this.state.lat,lon:this.state.lon,name:this.state.name.trim(),panorama:this.state.panorama,date:new Date(Date.now()),status:{approval:"pending",remarks:""}}).then(function(){t.doc.collection("submissions").doc(t.state.editDocId).delete()}).then(function(){return window.location.reload()}):null!=this.fileInput.current.files[0]&&/image\/*/g.test(this.fileInput.current.files[0].type)?ne.a.imageFileResizer(this.fileInput.current.files[0],4096,4096,"JPEG",70,0,function(e){t.setState({progressShown:!0});var a="".concat(t.state.name," - ").concat(me(),".jpeg"),n=t.storage.ref().child("".concat(t.props.currentUser.uid,"/").concat(a)).put(e);n.on(p.storage.TaskEvent.STATE_CHANGED,function(e){var a=e.bytesTransferred/e.totalBytes*100;t.setState({progress:a})},function(e){t.setState({error:!0})},function(){n.snapshot.ref.getDownloadURL().then(function(e){t.doc.set({currentUser:{name:t.props.currentUser.displayName,photoURL:t.props.currentUser.photoURL,uid:t.props.currentUser.uid}}),t.doc.collection("submissions").doc().set({facilities:{female:t.state.female,handicapped:t.state.handicapped,hose:t.state.hose,male:t.state.male,separateHandicapped:t.state.separateHandicapped,showerHeads:t.state.showerHeads,waterCooler:t.state.waterCooler},lat:t.state.lat,lon:t.state.lon,name:t.state.name.trim(),panorama:{url:e,fileName:a},date:new Date(Date.now()),status:{approval:"pending",remarks:""}}).then(function(){t.state.edit&&(t.doc.collection("submissions").doc(t.state.editDocId).delete(),t.storage.ref().child("".concat(t.props.currentUser.uid,"/").concat(t.state.panorama.fileName)).delete())}).then(function(){return window.location.reload()})})})},"blob"):alert("Please make sure file uploaded is an image")}},{key:"handleDelete",value:function(e,t){var a=this;window.confirm("Are you sure you want to delete this submission?")&&this.doc.collection("submissions").doc(t).delete().then(function(){return a.storage.ref().child("".concat(a.props.currentUser.uid,"/").concat(e)).delete().then(function(){return window.location.reload()})})}},{key:"handleEdit",value:function(e,t){window.scrollTo(0,0),this.setState({edit:!0,female:e.facilities.female,male:e.facilities.male,handicapped:e.facilities.handicapped,separateHandicapped:e.facilities.separateHandicapped,showerHeads:e.facilities.showerHeads,waterCooler:e.facilities.waterCooler,hose:e.facilities.hose,lat:e.lat,lon:e.lon,name:e.name,panorama:e.panorama,editDocId:t})}},{key:"render",value:function(){var e=this;return i.a.createElement(m,null,i.a.createElement("h1",null,"Submit to Let It Go"),!this.state.isLocationAvailable&&i.a.createElement(oe,null),i.a.createElement("a",{href:"https://github.com/nelsontky/let-it-go-submission/blob/master/HELPME.md",target:"__blank",rel:"noreferrer noopener"},"How do I do this?!"),this.state.edit&&i.a.createElement("h6",null,"Editing submission"),i.a.createElement("form",{onSubmit:this.handleSubmit},i.a.createElement(P.a,{label:"Name",placeholder:"Enter toilet name",fullWidth:!0,margin:"normal",variant:"outlined",InputLabelProps:{shrink:!0},name:"name",onChange:this.handleInputChange,value:this.state.name}),i.a.createElement(R.a,{onClick:this.setToCurrentLocation,variant:"contained"},"Set Lat Lon to current location"),i.a.createElement("br",null),i.a.createElement(P.a,{style:{marginRight:"1em"},label:"Latitude",margin:"normal",variant:"outlined",name:"lat",onChange:this.handleInputChange,value:this.state.lat}),i.a.createElement(P.a,{label:"Longitude",margin:"normal",variant:"outlined",name:"lon",onChange:this.handleInputChange,value:this.state.lon}),i.a.createElement(Y,{handleMapClick:this.handleMapClick,updateMyLocation:this.updateMyLocation,setLocationAvailable:this.setLocationAvailable,setLocationNotAvailable:this.setLocationNotAvailable}),i.a.createElement("br",null),i.a.createElement(ue.a,{component:"legend"},"Facilities"),i.a.createElement(de.a,null,i.a.createElement(ce.a,{control:i.a.createElement(le.a,{checked:this.state.male,onChange:this.handleInputChange,name:"male"}),label:"Male"}),i.a.createElement(ce.a,{control:i.a.createElement(le.a,{checked:this.state.female,onChange:this.handleInputChange,name:"female"}),label:"Female"}),i.a.createElement(ce.a,{control:i.a.createElement(le.a,{checked:this.state.handicapped,onChange:this.handleInputChange,name:"handicapped"}),label:"Handicapped"}),i.a.createElement(ce.a,{control:i.a.createElement(le.a,{checked:this.state.separateHandicapped,onChange:this.handleInputChange,name:"separateHandicapped",disabled:!this.state.handicapped}),label:"Separate Handicapped"}),i.a.createElement(ce.a,{control:i.a.createElement(le.a,{checked:this.state.hose,onChange:this.handleInputChange,name:"hose"}),label:"Hose"}),i.a.createElement(ce.a,{control:i.a.createElement(le.a,{checked:this.state.showerHeads,onChange:this.handleInputChange,name:"showerHeads"}),label:"Shower Heads"}),i.a.createElement(ce.a,{control:i.a.createElement(le.a,{checked:this.state.waterCooler,onChange:this.handleInputChange,name:"waterCooler"}),label:"Water Cooler"})),i.a.createElement("br",null),this.state.edit&&i.a.createElement("div",null,i.a.createElement(ce.a,{control:i.a.createElement(le.a,{checked:this.state.editPanorama,onChange:this.handleInputChange,name:"editPanorama"}),label:"Edit Panorama image"}),i.a.createElement("br",null)),i.a.createElement("input",{type:"file",name:"paranomaPath",accept:"image/*",ref:this.fileInput,id:"contained-button-file",style:{display:"none"}}),(!this.state.edit||this.state.editPanorama)&&i.a.createElement("label",{htmlFor:"contained-button-file"},i.a.createElement(R.a,{variant:"contained",component:"span"},"Select panorama image")),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(R.a,{variant:"contained",color:"primary",type:"submit",disabled:""===this.state.name||0===this.state.lat||0===this.state.lon},"Submit"),i.a.createElement("span",null,this.state.progressShown&&" "+Math.floor(this.state.progress)+"%"),i.a.createElement("p",null,this.state.error&&"An error occured, please refresh the page and try again"),this.state.edit&&i.a.createElement(R.a,{variant:"contained",color:"secondary",onClick:function(){return window.location.reload()}},"Cancel")),i.a.createElement(R.a,{color:"secondary",onClick:function(){return e.setState({submissionsShown:!e.state.submissionsShown})}},"".concat(this.state.submissionsShown?"Hide":"Show"," your submissions")),this.state.submissionsShown&&i.a.createElement(te,{uid:this.props.currentUser.uid,doc:this.doc,handleEdit:this.handleEdit,handleDelete:this.handleDelete}))}}]),t}(i.a.Component),pe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={isAdmin:!0},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(R.a,{onClick:function(){return e.setState({isAdmin:!e.state.isAdmin})},variant:"contained",color:"secondary"},"Switch to ".concat(this.state.isAdmin?"submission":"admin"," portal"))),this.state.isAdmin?i.a.createElement(B,null):i.a.createElement(he,{currentUser:this.props.currentUser}))}}]),t}(i.a.Component),be=a(82),ge=a.n(be);var ve={signInOptions:[p.auth.GoogleAuthProvider.PROVIDER_ID]},fe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={isSignedIn:!1},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.unregisterAuthObserver=p.auth().onAuthStateChanged(function(t){return e.setState({isSignedIn:!!t})})}},{key:"render",value:function(){return this.state.isSignedIn?i.a.createElement("div",null,i.a.createElement(m,null,i.a.createElement(R.a,{variant:"outlined",color:"primary",onClick:function(){return p.auth().signOut()}},"Sign Out")),"lowzxx@gmail.com"===(e=p.auth().currentUser.email)||"nelsontkyi@gmail.com"===e?i.a.createElement(pe,{currentUser:p.auth().currentUser}):i.a.createElement(he,{currentUser:p.auth().currentUser})):i.a.createElement(m,null,i.a.createElement("h1",null,"Submit to Let It Go"),i.a.createElement("p",null,"Please sign-in:"),i.a.createElement(ge.a,{uiConfig:ve,firebaseAuth:p.auth()}),i.a.createElement(g,null));var e}}]),t}(i.a.Component),Ee=a(83),we=a.n(Ee),ye=a(84),ke=a.n(ye),Se=a(85),Ce=new we.a(ke.a);Ce.injectStyles(),Object(Se.a)(Ce),r.a.render(i.a.createElement(fe,null),document.getElementById("root"))},99:function(e,t,a){e.exports=a(133)}},[[99,1,2]]]);
//# sourceMappingURL=main.3867b421.chunk.js.map